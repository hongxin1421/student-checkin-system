<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TCæ‰“å¡ç³»ç»Ÿ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #F5F7FA;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      padding: 40px;
      max-width: 800px;
      width: 100%;
    }

    h1 {
      text-align: center;
      color: #1E88E5;
      margin-bottom: 30px;
      font-size: 2.5em;
      background: #1E88E5;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .checkin-section {
      background: #FFFFFF;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      text-align: center;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    }

    .input-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: #757575;
      font-size: 1.1em;
    }

    input[type="text"] {
      width: 100%;
      padding: 15px;
      border: 2px solid #E0E0E0;
      border-radius: 10px;
      font-size: 1.1em;
      transition: border-color 0.3s ease;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #1E88E5;
      box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.1);
    }

    button {
      background: #1E88E5;
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 10px;
      font-size: 1.2em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(30, 136, 229, 0.3);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(30, 136, 229, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    .status-message {
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      font-weight: 600;
      text-align: center;
      display: none;
    }

    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
    }

    .results-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }

    .result-card {
      background: #FFFFFF;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    }

    .result-card h3 {
      margin-bottom: 20px;
      color: #212121;
      font-size: 1.3em;
      text-align: center;
    }

    .checked-in {
      background: #43A047;
      color: white;
    }

    .not-checked-in {
      background: #E53935;
      color: white;
    }

    .student-list {
      list-style: none;
    }

    .student-list li {
      padding: 8px 0;
      border-bottom: 1px solid #E0E0E0;
      font-weight: 500;
    }

    .student-list li:last-child {
      border-bottom: none;
    }

    .stats {
      text-align: center;
      margin-top: 20px;
      font-size: 1.1em;
      font-weight: 600;
      color: #212121;
    }

    @media (max-width: 768px) {
      .results-section {
        grid-template-columns: 1fr;
      }

      .container {
        padding: 20px;
      }

      h1 {
        font-size: 2em;
      }
    }

    /* æ–°ç­¾åˆ°åŠ¨ç”»æ•ˆæœ */
    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      10%,
      30%,
      50%,
      70%,
      90% {
        transform: translateX(-5px);
      }

      20%,
      40%,
      60%,
      80% {
        transform: translateX(5px);
      }
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
      }

      70% {
        transform: scale(1.02);
        box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
      }

      100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
      }
    }

    /* è½®æ’­å›¾æ ·å¼ */
    .carousel-container {
      position: relative;
      width: 100%;
      max-width: 800px;
      margin: 0 auto 30px;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .carousel-wrapper {
      position: relative;
      width: 100%;
      height: 400px;
      overflow: hidden;
    }

    .carousel-slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      transition: opacity 0.8s ease-in-out;
    }

    .carousel-slide.active {
      opacity: 1;
    }

    .carousel-slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .carousel-controls {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 100%;
      display: flex;
      justify-content: space-between;
      padding: 0 20px;
      z-index: 10;
    }

    .carousel-btn {
      background: rgba(30, 136, 229, 0.3);
      color: white;
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .carousel-btn:hover {
      background: rgba(30, 136, 229, 1);
      transform: scale(1.1);
    }

    .carousel-indicators {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 10;
    }

    .indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.5);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .indicator.active {
      background: #1E88E5;
      transform: scale(1.2);
    }

    .carousel-caption {
      position: absolute;
      bottom: 60px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.6);
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      text-align: center;
      backdrop-filter: blur(10px);
      max-width: 80%;
    }

    .carousel-caption h3 {
      margin-bottom: 5px;
      font-size: 1.3em;
    }

    .carousel-caption p {
      font-size: 0.9em;
      opacity: 0.9;
    }

    @media (max-width: 768px) {
      .carousel-wrapper {
        height: 250px;
      }

      .carousel-btn {
        width: 40px;
        height: 40px;
        font-size: 16px;
      }

      .carousel-caption {
        bottom: 50px;
        padding: 10px 15px;
      }

      .carousel-caption h3 {
        font-size: 1.1em;
      }

      .carousel-caption p {
        font-size: 0.8em;
      }
    }

    .sync-indicator {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #28a745;
      color: white;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 12px;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 1000;
    }

    .sync-indicator.active {
      opacity: 1;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- è½®æ’­å›¾ -->
    <div class="carousel-container">
      <div class="carousel-wrapper" id="carouselWrapper">
        <!-- è½®æ’­å›¾ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
      </div>

      <!-- æ§åˆ¶æŒ‰é’® -->
      <div class="carousel-controls">
        <button class="carousel-btn" id="prevBtn">â€¹</button>
        <button class="carousel-btn" id="nextBtn">â€º</button>
      </div>

      <!-- æŒ‡ç¤ºå™¨ -->
      <div class="carousel-indicators" id="indicators"></div>

      <!-- å›¾ç‰‡æè¿° -->
      <div class="carousel-caption" id="carouselCaption" style="display: none;">
        <h3 id="captionTitle"></h3>
        <p id="captionText"></p>
      </div>
    </div>

    <div id="syncIndicator" class="sync-indicator">ğŸ”„ æ•°æ®åŒæ­¥ä¸­...</div>
    <h1>ğŸ“š TCæ‰“å¡ç³»ç»Ÿ</h1>

    <div class="checkin-section">
      <div class="input-group">
        <label for="studentName">è¯·è¾“å…¥ä½ çš„å§“åï¼š</label>
        <input type="text" id="studentName" placeholder="ä¾‹å¦‚ï¼šå¼ ä¸‰" maxlength="20">
      </div>
      <button onclick="checkIn()">ğŸ¯ æ‰“å¡ç­¾åˆ°</button>
      <div id="statusMessage" class="status-message"></div>
    </div>

    <div class="stats" id="stats"></div>

    <div class="results-section">
      <div class="result-card checked-in">
        <h3>âœ… å·²ç­¾åˆ°åŒå­¦</h3>
        <ul id="checkedInList" class="student-list"></ul>
      </div>

      <div class="result-card not-checked-in">
        <h3>âŒ æœªç­¾åˆ°åŒå­¦</h3>
        <ul id="notCheckedInList" class="student-list"></ul>
      </div>
    </div>
  </div>

  <script>
    let studentList = [];
    let checkedInStudents = [];

    // é¡µé¢åŠ è½½æ—¶è·å–å­¦ç”Ÿåå•å’Œç­¾åˆ°çŠ¶æ€
    window.onload = function () {
      loadStudentList();
      // å¯åŠ¨å®æ—¶åŒæ­¥ - æ¯3ç§’è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡æ•°æ®
      startRealTimeSync();
    };

    // åŠ è½½å­¦ç”Ÿåå•
    async function loadStudentList() {
      try {
        const response = await fetch('/api/students');
        studentList = await response.json();
        loadCheckInStatus();
      } catch (error) {
        console.error('è·å–å­¦ç”Ÿåå•å¤±è´¥:', error);
        // å¦‚æœè·å–å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤åå•
        studentList = [
          'å¼ ä¸‰', 'æå››', 'ç‹äº”', 'èµµå…­', 'é’±ä¸ƒ', 'å­™å…«', 'å‘¨ä¹', 'å´å',
          'éƒ‘åä¸€', 'ç‹åäºŒ', 'å†¯åä¸‰', 'é™ˆåå››', 'è¤šåäº”', 'å«åå…­', 'è’‹åä¸ƒ', 'æ²ˆåå…«'
        ];
        loadCheckInStatus();
      }
    }

    // åŠ è½½ç­¾åˆ°çŠ¶æ€
    async function loadCheckInStatus() {
      try {
        const response = await fetch('/api/checkin-status');
        const data = await response.json();

        if (data.checkedInStudents) {
          checkedInStudents = data.checkedInStudents;
          updateDisplay();
        }
      } catch (error) {
        console.error('è·å–ç­¾åˆ°çŠ¶æ€å¤±è´¥:', error);
      }
    }

    // ç­¾åˆ°åŠŸèƒ½
    async function checkIn() {
      const nameInput = document.getElementById('studentName');
      const name = nameInput.value.trim();
      const statusMessage = document.getElementById('statusMessage');

      // éªŒè¯è¾“å…¥
      if (!name) {
        showMessage('è¯·è¾“å…¥å§“åï¼', 'error');
        return;
      }

      // æ£€æŸ¥æ˜¯å¦åœ¨å­¦ç”Ÿåå•ä¸­
      if (!studentList.includes(name)) {
        showMessage('è¾“å…¥çš„å§“åä¸åœ¨å­¦ç”Ÿåå•ä¸­ï¼Œè¯·é‡æ–°è¾“å…¥ï¼', 'warning');
        return;
      }

      // æ£€æŸ¥æ˜¯å¦å·²ç»ç­¾åˆ°
      if (checkedInStudents.includes(name)) {
        showMessage('ä½ å·²ç»ç­¾åˆ°è¿‡äº†ï¼Œæ— éœ€é‡å¤ç­¾åˆ°ï¼', 'warning');
        return;
      }

      try {
        // å‘é€ç­¾åˆ°è¯·æ±‚
        const response = await fetch('/api/checkin', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ name: name })
        });

        const data = await response.json();

        if (data.success) {
          showMessage(`ç­¾åˆ°æˆåŠŸï¼æ¬¢è¿ ${name}ï¼`, 'success');
          nameInput.value = '';
          // é‡æ–°è·å–æœ€æ–°çš„ç­¾åˆ°çŠ¶æ€å’Œæ•°æ®
          await loadCheckInStatus();
        } else {
          // å¤„ç†IPå†²çªç‰¹æ®Šæƒ…å†µ
          if (data.type === 'ip_conflict') {
            // IPå†²çªè­¦å‘Šæ˜¾ç¤ºç»™æ‰€æœ‰ç”¨æˆ·
            showMessage(`âš ï¸ æ£€æµ‹åˆ°ä»£ç­¾è¡Œä¸ºï¼š${data.originalName} è¯•å›¾å¸® ${name} ä»£ç­¾ï¼`, 'warning');
            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é¢å¤–çš„è­¦å‘Šæ•ˆæœ
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.style.background = '#ff6b6b';
            statusMessage.style.color = 'white';
            statusMessage.style.fontWeight = 'bold';
            statusMessage.style.animation = 'shake 0.5s ease-in-out';
            // 8ç§’åæ¢å¤æ­£å¸¸æ ·å¼
            setTimeout(() => {
              statusMessage.style.background = '';
              statusMessage.style.color = '';
              statusMessage.style.fontWeight = '';
              statusMessage.style.animation = '';
            }, 8000);
          } else {
            showMessage(data.message || 'ç­¾åˆ°å¤±è´¥ï¼Œè¯·é‡è¯•ï¼', 'error');
          }
        }
      } catch (error) {
        console.error('ç­¾åˆ°è¯·æ±‚å¤±è´¥:', error);
        showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•ï¼', 'error');
      }
    }

    // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
    function showMessage(message, type) {
      const statusMessage = document.getElementById('statusMessage');
      statusMessage.textContent = message;
      statusMessage.className = `status-message ${type}`;
      statusMessage.style.display = 'block';

      // 8ç§’åè‡ªåŠ¨éšè—æ¶ˆæ¯
      setTimeout(() => {
        statusMessage.style.display = 'none';
      }, 8000);
    }

    // æ›´æ–°æ˜¾ç¤º
    function updateDisplay() {
      const checkedInList = document.getElementById('checkedInList');
      const notCheckedInList = document.getElementById('notCheckedInList');
      const stats = document.getElementById('stats');

      // æ¸…ç©ºåˆ—è¡¨
      checkedInList.innerHTML = '';
      notCheckedInList.innerHTML = '';

      // åˆ†ç¦»å·²ç­¾åˆ°å’Œæœªç­¾åˆ°å­¦ç”Ÿ
      const notCheckedIn = studentList.filter(name => !checkedInStudents.includes(name));

      // æ˜¾ç¤ºå·²ç­¾åˆ°å­¦ç”Ÿ
      if (checkedInStudents.length > 0) {
        checkedInStudents.forEach(name => {
          const li = document.createElement('li');
          li.textContent = name;
          checkedInList.appendChild(li);
        });
      } else {
        const li = document.createElement('li');
        li.textContent = 'æš‚æ— ç­¾åˆ°è®°å½•';
        checkedInList.appendChild(li);
      }

      // æ˜¾ç¤ºæœªç­¾åˆ°å­¦ç”Ÿ
      if (notCheckedIn.length > 0) {
        notCheckedIn.forEach(name => {
          const li = document.createElement('li');
          li.textContent = name;
          notCheckedInList.appendChild(li);
        });
      } else {
        const li = document.createElement('li');
        li.textContent = 'æ‰€æœ‰åŒå­¦éƒ½å·²ç­¾åˆ°';
        notCheckedInList.appendChild(li);
      }

      // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
      const total = studentList.length;
      const checkedInCount = checkedInStudents.length;
      const notCheckedInCount = total - checkedInCount;
      const attendanceRate = Math.round((checkedInCount / total) * 100);

      stats.innerHTML = `
                æ€»äººæ•°: <strong>${total}</strong> | 
                å·²ç­¾åˆ°: <strong style="color: #28a745;">${checkedInCount}</strong> | 
                æœªç­¾åˆ°: <strong style="color: #dc3545;">${notCheckedInCount}</strong> | 
                å‡ºå‹¤ç‡: <strong style="color: #667eea;">${attendanceRate}%</strong>
            `;
    }

    // å›è½¦é”®è§¦å‘ç­¾åˆ°
    document.getElementById('studentName').addEventListener('keypress', function (e) {
      if (e.key === 'Enter') {
        checkIn();
      }
    });

    // å®æ—¶åŒæ­¥åŠŸèƒ½
    let syncInterval;
    let lastCheckInCount = 0;
    let lastIpConflictEvent = null;  // è®°å½•ä¸Šæ¬¡çš„IPå†²çªäº‹ä»¶

    function startRealTimeSync() {
      // æ¯3ç§’æ£€æŸ¥ä¸€æ¬¡æœ€æ–°æ•°æ®
      syncInterval = setInterval(async () => {
        const syncIndicator = document.getElementById('syncIndicator');
        try {
          // æ˜¾ç¤ºåŒæ­¥æŒ‡ç¤ºå™¨
          syncIndicator.classList.add('active');

          const response = await fetch('/api/checkin-status');
          const data = await response.json();

          // æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„ç­¾åˆ°
          if (data.checkedInCount !== lastCheckInCount) {
            const hasNewCheckIn = data.checkedInCount > lastCheckInCount;
            lastCheckInCount = data.checkedInCount;

            // æ›´æ–°æœ¬åœ°æ•°æ®
            if (data.checkedInStudents) {
              checkedInStudents = data.checkedInStudents;
              updateDisplay();

              // å¦‚æœæœ‰æ–°ç­¾åˆ°ï¼Œæ˜¾ç¤ºè§†è§‰æç¤º
              if (hasNewCheckIn && data.checkedInCount > 0) {
                showNewCheckInAnimation();
                console.log(`ğŸ“¢ æ£€æµ‹åˆ°æ–°ç­¾åˆ°ï¼š${data.checkedInCount}äººå·²ç­¾åˆ°`);
              }
            }
          }

          // æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„IPå†²çªäº‹ä»¶
          if (data.ipConflictEvent && (!lastIpConflictEvent ||
            data.ipConflictEvent.timestamp !== lastIpConflictEvent.timestamp)) {
            lastIpConflictEvent = data.ipConflictEvent;

            // æ˜¾ç¤ºIPå†²çªè­¦å‘Šç»™æ‰€æœ‰ç”¨æˆ·
            showMessage(`âš ï¸ æ£€æµ‹åˆ°ä»£ç­¾è¡Œä¸ºï¼š${data.ipConflictEvent.originalName} è¯•å›¾å¸® ${data.ipConflictEvent.currentName} ä»£ç­¾ï¼`, 'warning');

            // æ·»åŠ è§†è§‰è­¦å‘Šæ•ˆæœ
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.style.background = '#ff6b6b';
            statusMessage.style.color = 'white';
            statusMessage.style.fontWeight = 'bold';
            statusMessage.style.animation = 'shake 0.5s ease-in-out';

            // 5ç§’åæ¢å¤æ­£å¸¸æ ·å¼
            setTimeout(() => {
              statusMessage.style.background = '';
              statusMessage.style.color = '';
              statusMessage.style.fontWeight = '';
              statusMessage.style.animation = '';
            }, 5000);

            console.log(`ğŸš¨ æ£€æµ‹åˆ°IPå†²çªï¼š${data.ipConflictEvent.currentName} è¯•å›¾å¸® ${data.ipConflictEvent.originalName} ä»£ç­¾`);
          }

          // éšè—åŒæ­¥æŒ‡ç¤ºå™¨
          setTimeout(() => {
            syncIndicator.classList.remove('active');
          }, 500);

        } catch (error) {
          console.error('å®æ—¶åŒæ­¥å¤±è´¥:', error);
          // éšè—åŒæ­¥æŒ‡ç¤ºå™¨
          syncIndicator.classList.remove('active');
        }
      }, 3000); // 3ç§’æ£€æŸ¥ä¸€æ¬¡
    }

    // æ–°ç­¾åˆ°åŠ¨ç”»æ•ˆæœ
    function showNewCheckInAnimation() {
      const checkedInCard = document.querySelector('.checked-in');
      const stats = document.getElementById('stats');

      // æ·»åŠ é—ªçƒæ•ˆæœ
      if (checkedInCard) {
        checkedInCard.style.animation = 'pulse 0.6s ease-in-out 2';
        setTimeout(() => {
          checkedInCard.style.animation = '';
        }, 1200);
      }

      // ç»Ÿè®¡åŒºåŸŸé«˜äº®
      if (stats) {
        stats.style.background = '#1E88E5';
        stats.style.color = 'white';
        setTimeout(() => {
          stats.style.background = '';
          stats.style.color = '';
        }, 1000);
      }
    }

    // é¡µé¢å¸è½½æ—¶æ¸…é™¤å®šæ—¶å™¨
    window.addEventListener('beforeunload', function () {
      if (syncInterval) {
        clearInterval(syncInterval);
      }
      if (carouselInterval) {
        clearInterval(carouselInterval);
      }
    });

    // è½®æ’­å›¾åŠŸèƒ½
    let currentSlide = 0;
    let carouselInterval;

    // è½®æ’­å›¾é…ç½®
    const carouselConfig = {
      images: [
        {
          src: '/images/slide1.jpg',
          title: 'æ¬¢è¿æ¬¢è¿',
          description: 'æ¬¢è¿æ¥åˆ°ç”²éª¨æ–‡TC'
        },
        {
          src: '/images/slide2.jpg',
          title: 'ä¿æŒçƒ­çˆ±',
          description: 'ä¸å¿˜åˆå¿ƒç»§ç»­çƒ­çˆ±'
        },
        {
          src: '/images/slide3.jpg',
          title: 'çƒ­çˆ±ä¸æ‰“çƒŠ',
          description: 'è¿™æ¡è·¯æ³¨å®šä¸å¹³å‡¡'
        },
        {
          src: '/images/slide4.jpg',
          title: 'çº¯ç²¹çš„çˆ±',
          description: 'æœ€çº¯ç²¹çš„çˆ±åªä¸ºè®¡ç®—æœº'
        }
      ],
      autoPlay: true,
      interval: 4000 // 4ç§’åˆ‡æ¢
    };

    // åˆå§‹åŒ–è½®æ’­å›¾
    function initCarousel() {
      const wrapper = document.getElementById('carouselWrapper');
      const indicators = document.getElementById('indicators');

      console.log('åˆå§‹åŒ–è½®æ’­å›¾...');
      console.log('æ‰¾åˆ°wrapperå…ƒç´ :', wrapper);
      console.log('æ‰¾åˆ°indicatorså…ƒç´ :', indicators);
      console.log('å›¾ç‰‡é…ç½®:', carouselConfig.images);

      // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
      const debugInfo = document.createElement('div');
      debugInfo.style.cssText = 'position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; z-index: 9999; font-size: 12px;';
      debugInfo.innerHTML = 'è½®æ’­å›¾åˆå§‹åŒ–ä¸­...';
      document.body.appendChild(debugInfo);

      // åˆ›å»ºè½®æ’­å›¾ç‰‡
      carouselConfig.images.forEach((image, index) => {
        console.log(`åˆ›å»ºè½®æ’­å›¾ç‰‡ ${index}:`, image);
        const slide = document.createElement('div');
        slide.className = `carousel-slide ${index === 0 ? 'active' : ''}`;
        slide.innerHTML = `
                    <img src="${image.src}" alt="${image.title}" onerror="handleImageError(this, '${image.title}');">
                `;
        wrapper.appendChild(slide);
        console.log(`è½®æ’­å›¾ç‰‡ ${index} åˆ›å»ºå®Œæˆ`);
        debugInfo.innerHTML += `<br>å›¾ç‰‡ ${index}: ${image.src}`;
      });

      debugInfo.innerHTML += '<br>è½®æ’­å›¾åˆå§‹åŒ–å®Œæˆ';
      setTimeout(() => {
        debugInfo.remove();
      }, 5000);

      // åˆ›å»ºæŒ‡ç¤ºå™¨
      carouselConfig.images.forEach((_, index) => {
        const indicator = document.createElement('div');
        indicator.className = `indicator ${index === 0 ? 'active' : ''}`;
        indicator.addEventListener('click', () => goToSlide(index));
        indicators.appendChild(indicator);
      });

      // æ·»åŠ æ§åˆ¶æŒ‰é’®äº‹ä»¶
      document.getElementById('prevBtn').addEventListener('click', () => {
        const newIndex = (currentSlide - 1 + carouselConfig.images.length) % carouselConfig.images.length;
        goToSlide(newIndex);
        resetAutoPlay();
      });

      document.getElementById('nextBtn').addEventListener('click', () => {
        const newIndex = (currentSlide + 1) % carouselConfig.images.length;
        goToSlide(newIndex);
        resetAutoPlay();
      });

      // å¼€å§‹è‡ªåŠ¨æ’­æ”¾
      if (carouselConfig.autoPlay) {
        startAutoPlay();
      }

      // é¼ æ ‡æ‚¬åœæ—¶æš‚åœè‡ªåŠ¨æ’­æ”¾
      const carouselContainer = document.querySelector('.carousel-container');
      carouselContainer.addEventListener('mouseenter', stopAutoPlay);
      carouselContainer.addEventListener('mouseleave', () => {
        if (carouselConfig.autoPlay) {
          startAutoPlay();
        }
      });
    }

    // åˆ‡æ¢åˆ°æŒ‡å®šå¹»ç¯ç‰‡
    function goToSlide(index) {
      const slides = document.querySelectorAll('.carousel-slide');
      const indicators = document.querySelectorAll('.indicator');
      const captionTitle = document.getElementById('captionTitle');
      const captionText = document.getElementById('captionText');
      const caption = document.getElementById('carouselCaption');

      // éšè—æ‰€æœ‰å¹»ç¯ç‰‡
      slides.forEach(slide => slide.classList.remove('active'));
      indicators.forEach(indicator => indicator.classList.remove('active'));

      // æ˜¾ç¤ºå½“å‰å¹»ç¯ç‰‡
      slides[index].classList.add('active');
      indicators[index].classList.add('active');

      // æ›´æ–°å›¾ç‰‡æè¿°
      const image = carouselConfig.images[index];
      if (image.title || image.description) {
        captionTitle.textContent = image.title || '';
        captionText.textContent = image.description || '';
        caption.style.display = 'block';
      } else {
        caption.style.display = 'none';
      }

      currentSlide = index;
    }

    // å¼€å§‹è‡ªåŠ¨æ’­æ”¾
    function startAutoPlay() {
      stopAutoPlay(); // å…ˆåœæ­¢ä¹‹å‰çš„å®šæ—¶å™¨
      carouselInterval = setInterval(() => {
        const newIndex = (currentSlide + 1) % carouselConfig.images.length;
        goToSlide(newIndex);
      }, carouselConfig.interval);
    }

    // åœæ­¢è‡ªåŠ¨æ’­æ”¾
    function stopAutoPlay() {
      if (carouselInterval) {
        clearInterval(carouselInterval);
        carouselInterval = null;
      }
    }

    // é‡ç½®è‡ªåŠ¨æ’­æ”¾
    function resetAutoPlay() {
      if (carouselConfig.autoPlay) {
        stopAutoPlay();
        startAutoPlay();
      }
    }

    // å›¾ç‰‡åŠ è½½é”™è¯¯å¤„ç†
    function handleImageError(img, title) {
      console.log(`å›¾ç‰‡åŠ è½½å¤±è´¥: ${img.src}, æ ‡é¢˜: ${title}`);
      img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjBmMGYwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueLiOadveaWh+aho+S8oOecn+WbvueJhzwvdGV4dD48L3N2Zz4=';
    }

    // åˆå§‹åŒ–è½®æ’­å›¾ - ç¡®ä¿DOMåŠ è½½å®Œæˆåå†åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function () {
      console.log('DOMåŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–è½®æ’­å›¾...');
      initCarousel();
    });

    // å¦‚æœDOMContentLoadedå·²ç»è§¦å‘ï¼Œç›´æ¥åˆå§‹åŒ–
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function () {
        initCarousel();
      });
    } else {
      initCarousel();
    }
  </script>
</body>

</html>